# 消息队列

## 为什么用消息队列

你们公司有个什么业务场景，这个业务场景有个什么技术挑战，如果不用 MQ 可能会很麻烦，但是你现在用了 MQ 之后带给了你很多的好处。

先说一下消息队列常见的使用场景吧，其实场景有很多，但是比较核心的有 3 个：解耦、异步、削峰。

* 解耦：通过一个 MQ，Pub/Sub 发布订阅消息这么一个模型，A 系统就跟其它系统彻底解耦了。
* 异步：发送消息后立即返回，客户端无需等待执行完毕，异步执行，响应较快。
* 削峰：多余的未处理的消息先堆积在消息队列中。

## 消息队列有什么优缺点

优点：解耦、异步、削峰

缺点：

* 可用性降低
* 系统复杂度提高：需要解决幂等性、消息丢失、消息传递顺序等问题。
* 一致性问题

## RocketMQ

## 幂等性

## 有三个消息队列，随机的向三个队列插入元素(概率可能不同)，如何保证插入和查找的高效

(有两种思路，一种是加一个控制器，队列通知占用率，由控制器控制插入和查找，另一种是计算阻塞次数，再根据阻塞次数按比例控制该队列的插入频率和查找频率)
