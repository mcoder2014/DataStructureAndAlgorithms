# 计算机网络（更多面试问题，欢迎关注微信公众号「帅地玩编程」）

## 其他面试题

### MTU 和 MSS 区别

- MTU： Maximum Transmit Unit，最大传输单元，即物理接口（数据链路层）提供给其上层（通常是IP层）最大一次传输数据的大小；以普遍使用的以太网接口为例，缺省MTU=1500 Byte。帧的首部是18字节
- TCP提交给IP层最大分段大小，不包含TCP Header和 TCP Option，只包含TCP Payload

## http

### 响应码

- 1XX：信息状态码，例如100表示到目前为止都很正常，客户端可以继续发送请求或者忽略这个响应
- 2XX：成功状态码，例如200表OK，204表不包含实体；206表示范围请求
- 3XX：重定向

  - 301：永久性重定向
  - 302：临时性重定向
  - 304 Not Modified：如果不满足首部的一些条件则返回304
  - 307：临时性重定向，但要求浏览器不会把重定向请求的 post方法改成 get 方法

- 4XX：客户端错误

  - 400 Bad Request：请求报文存在语法错误
  - 401 Unauthorized：表示发送的请求需要有认证信息
  - 403:请求被拒绝
  - 404：Not Found

- 5XX：服务器错误

  - 500：服务器正在执行请求时发生了错误
  - 503：服务器处于超负载或者停机维护，无法处理请求

### 首部

- 通用

  - Cache-Control
  - Connective
  - Date

- 请求

  - Host
  - Accept-Encoding
  - if-modified-since
  - user-agent
  - accept

- 响应

  - Location：令客户端重定向到指定URI
  - Server
  - Accept-Ranges：是否接收字节范围的请求

- 实体首部字段

  - Expired
  - Last-Modified
  - Content-Type
  - Content-Length
  - Content-Encoding

### 版本区别

- http1.0:不能长连接，只能短连接
- http1.1:一个TCP连接可以发送多个HTTP请求，不过服务器只能按照顺序一个一个响应。
- http2.0采用了多路复用，它把HTTP报文分解成更小的二进制帧来传送，不同的HTTP请求报文可以混合在一个TCP连接上传输，服务器收到后，在根据二进制帧里面存放的ID来进行分类

### 请求方法

- get，参数会显示在地址栏，不安全
- post，参数放在实体部分
- head:不返回实体部分，确认URL的有效性以及资源更新日期
- put: 上传文件
- patch：对部分资源进行修改
- delete
- option: 查询支持的方法
- trace：服务器会将通信路径返回给客户端

### 幂等性

- 定义：同样的请求被执行一次与连续执行多次的效果是一样的，服务器的状态也是一样的
- get, head, put, delete 方法是幂等性的，而post不是。

### 缺点

- 明文传输，容易被窃听
- 没有验证对方身份，容易遭到伪装
- 无法证明报文的完整性，容易被篡改

### 攻击

- 跨站脚本攻击
- SQL注入
- OS命令攻击

## ICMP

### 分为差错报告报文和询问报文，工作在网络层

### 类型的值

- 3：终点不可达
- 11：时间超时
- 5：改变路由
- 8或者0：回送（echo）请求或者回答
- 13或者14：时间戳请求或者回答

### 应用

- ping：通过向目的主机发送 ICMP echo 请求报文，目的主机收到后会回送 echo 回答报文，ping 会根据时间和成功响应的次数来估算数据包的往返时间以及丢包率
- traceroute：发送的 IP 数据报封装的是不可交付的 UDP 用户数据报，并由目的主机发送终点不可达差错报文。     例如 发送 TTL 为 1 的数据报，R1 收到后把 TTL 减1变为0，R1 把 P1 丢弃，向源主机发送ICMP时间超时报文。    主机收到后，发现数据包封装的是不可交付的 UDP，此时就会向目的主机发送终点不可达的差错报文了。

## DHCP

### 1、发送 Discover 报文（UDP），把 255.255.255.255：67作为目的地址，0.0.0.0：68作为源地址

### 2、DHCP 服务器收到后发广播一个 Offer 报文，包含 ip，网关、有效期等

### 3、客户端选择一个报文，然后向服务器发送一个 Request 报文

### 4、服务器收到后会发送一个 ACK 报文，并且把该 IP 标记为已使用

### 一般客户端会在租约时间到达 1/2 的时候，客户端会向DHCP单播request报文，以此来续约。如果续约失败，会在 7/8 再次发送request报文。bug此时的处理情况如果首次分配 ip 地址

## ARP

## DNS

### 先浏览器缓存查，没有则本地host文件查，没有就请求DNS服务器，主要是递归和迭代两种方式相结合

### Linux下的DNS解析命令：dig

### 根域名->顶级域名->次级域名->主机名

## TCP

### 三次握手

- 握手过程

  - 客户端发送 SYN 报文，指定序列号 ISN，处于SYN_Send状态
  - 服务端把SYN作为应答，指定ISN，把客户端的 ISN+1作为ACK值，此时处于SYN_REVD状态
  - 客户端发送一个ACK报文，此时处于establised状态
  - 服务器收到ACK报文后也处于establised状态

- 用处

  - 确认双方的交付能力
  - 指定初始序列号，为可靠传输做准备
  - 交互加密机制

- 相关问题

  - ISN固定吗
  - 半连接队列
  - 握手过程可以携带数据吗

### 四次挥手

- 挥手过程

  - 1、客户端发送FIN报文，指定序列号，此时处于FIN_WAIT状态
  - 2、服务器收到后发送ACK报文，处于Closed_Wait状态
  - 3、客户端收到ACK报文后处于FIN_Wait2状态
  - 4、服务器发送FIN报文，处于LAST_ACK状态
  - 5、客户端发送一个ACK报文，处于TIME_WAIT状态

- TIME_WAIT

  - 确保服务器已经收到ACK报文
  - 持续时间至少为一个报文的来回时间
  - 如果没有这个状态会发生什么？

    - 同ip同端口再次建立起连接，并且原来的连接还残留有数据，这个时候会被新的连接所接收

  - 解决方法

    - 修改配置文件，现在最大连接数（/etc/security/limits.conf）
    - 修改默认的等待时间（/etc/sysctl.conf）。net.ipv4.tcp_fin_timeout=2
    - 允许重用端口：net.ipv4.tcp_tw_reuse=1
    - 开启快速回收策略：net.ipv4.tcp_tw_recycle=1

- Close_Wait状态

  - 无论是time_wait还是close_wait滞留太多，我们可以通过so_ reuseaddr参数来强行重用端口

### 流量控制

- 接收方每次发送确认报文的时候，可以告诉发送方的接收窗口大小，当为0时，发送方停止发送
- 之后发送方开发一个定时器，每隔一段时间发送测试报文去询问接收方的窗口大小

### 拥塞控制

- 慢启动：1，2，4....指数增长
- 拥塞避免：慢启动到底阀值，就开始线性增长
- 到达瓶颈值怎么办？

  - 把阀值调为瓶颈值的一半，接着在来用慢启动+拥塞避免

- 超时不一定就是网络拥塞

  - 快速重传：如果B收到了，M1,M2,M4,M5确始终没有收到M2，那么B会连续给A发送M2的ACK确认报文，意在告诉A可能M3丢失了，当A连续收到M2的三次ACK，但M3还没超时，那么A就会发送M3。
  - 快速恢复：该事件发送之后，会把阀值设置为瓶颈值的一半，并且把滑动窗口设置为阀值，之后线性增长。这个版本也称之为TCP Reno。而不具备这个功能的称之为 TCP Tahoe

### 可靠传输

- 确认-重传机制
- 回退N步协议

  - 接收方

    - 如果是按序到达的，则接收，否则发送ACK确认

  - 发送方

    - 收到M4的ACK，代表M4之前的也正常交付了
    - 发送超时事件时，会重发所有已经发送但未得到确认的报文
    - 注意，这个只设置一个定时器就可以了

- 选择重传

  - 接收方会缓存没有按序达到的报文，等到按序后，在发送ACK
  - 发送方会为每个报文设置一个定时器，那个超时就发送哪个
  - bug这个时候还有一个问题：

### 与UDP的差别

- UDP

  - 无连接
  - 不可靠
  - 面向报文（对上层来的报文不做拆分合并，只是封装上UDP首部）
  - 支持一对多，多对一

- TCP

  - 可靠的
  - 面向连接的
  - 面向字节流的（把报文看成字节流，拆分组织成大小不等的数据块）
  - 只能一对一

### TCP 首部

- 固定的20字节+4字节的（选项+ 填充）
- RST报文

  - 访问的端口不存在
  - 访问的端口正处于 time_wait 状态
  - 异常终止
  - 处理半连接状态

## Web的请求顺序回答

## HTTPS

### 加密的两种方式

- 建立安全的通信通道

  - SSL（Secure Socket Layer）安全套接层
  - TLS（Transport Layer Security ）安全层传输协议

- 对内容进行加密

### HTTPS是披着SSL外壳的HTTP

### 具体步骤

- 1、服务器用hash算法把一些个人信息以及公钥生成信息摘要
- 2、接着服务器把自己的公钥以及个人信息用CA的私钥进行加密，把加密后的信息和信息摘要合并成数字证书
- 客户端收到后，会用CA提供的公钥对加密的部分进行解密，解密之后进行hash。把hash后的结果与信息摘要进行对比。
- 客户端的公钥已经提前植入到浏览器的了

### 具体的握手过程

- 客户端：发送hello报文，报文指定自己接受的ssl版本，加密组件等（例如加密算法以及长度）
- 服务器：同样告诉客户端自己接收的ssl版本，加密组件等信息，不过加密组件是从客户端那里选择
- 服务器：紧接着发送数字证书，当然，数字证书包含服务器的公钥
- 客户端：接着客户端给服务器发送一个用来加密的随机密码串。当然，该报文会用公钥进行加密

### 客户端证书

- 意味着每个用户都需要一个证书，需要自己安装
- 例如网银登录的时候，需要证书
