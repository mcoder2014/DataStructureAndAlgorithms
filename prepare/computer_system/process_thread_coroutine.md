# 进程 线程 协程

## 进程

进程（英语：process），是指计算机中已运行的程序。进程由程序段、相关数据段和PCB三部分组成：

1. 程序段是指进程运行的程序代码；
2. 数据段是指程序运行的相关数据；
3. PCB是进程控制块，包含进程的相关数据，是进程存在的唯一标志。

### 进程的状态转换

- 创建 new: 创建新的进程
- 运行 running: 进程正在运行
- 等待 waiting: 进程在阻塞，等待事件发生（如IO）
- 就绪 ready: 进程等待 CPU调度
- 结束 terminated: 进程运行完成

### PCB 进程控制块

process control block 是操作系统核心中的一种数据结构，一般包括如下内容：

- 状态: (创建、运行、等待、就绪、结束)
- PC 计数器: 指向要运行的指令地址
- CPU 寄存器: 保存寄存器的内容
- CPU 调度相关内容: 优先级、队列等参数
- 存储器管理: 页表等
- 统计信息: CPU 实际使用时间、账号、进程号等
- IO 信息: 进程使用的 IO 信息等

## 线程

线程是操作系统调度和分派的最小单位，同一个进程中的多个线程共享进程的全部系统资源：虚拟地址空间、文件描述符、信号处理等。但多个线程有各自的调用栈(call stack)，自己的寄存器环境(register context)，自己的线程本地存储(threadlocal)。

进程与线程的区别：进程是计算机管理运行程序的一种方式，一个进程下可包含一个或者多个线程。线程可以理解为子进程。

### 线程的状态

1. 运行状态
2. 就绪状态
3. 等待状态

### TCB 线程控制块

- 线程标识符
- 寄存器
- 线程运行状态
- 优先级
- 线程专有存储区
- 信号屏蔽

## 协程

协程非常类似于线程。但是协程是协作式多任务的，而线程典型是抢占式多任务的。这意味着协程提供并发性而非并行性。协程超过线程的好处是它们可以用于硬性实时的语境（在协程之间的切换不需要涉及任何系统调用或任何阻塞调用），这里不需要用来守卫关键区块的同步性原语（primitive）比如互斥锁、信号量等，并且不需要来自操作系统的支持。有可能以一种对调用代码透明的方式，使用抢占式调度的线程实现协程，但是会失去某些利益（特别是对硬性实时操作的适合性和相对廉价的相互之间切换）。

## 进程和线程的资源

进程拥有的：

- 全局变量；
- 堆上的数据；
- 静态变量；
- 代码区；
- 资源（如文件描述符）；

线程私有的：

- 局部变量(线程栈)；
- 函数参数(栈上或者寄存器上)
- 寄存器(包括 PC 程序计数器)
- ThreadLocal 变量

## Reference
