# fork exec clone

## fork

* fork()是调用一次返回两次，在子进程中返回值为0(子进程可以通过getppid()获取父进程的ID)，在父进程中返回值为子进程的ID(因为父进程会有多个子进程，并且无法获取子进程ID)
* fork通常采用COW机制：对于父子进程共享的区域，内核将它们设置为只读；如果父、子进程中的任一试图修改这些只读区域，则内核只为修改区域的那块内存复制一个副本，通常是一“页”
* fork的一个特性：父进程的所有打开文件描述符都被复制到子进程中，父子进程的每个相同的文件描述符共享一个文件表项

### vfork

* 调用序列和返回值与fork相同
* 通过vfork创建的子进程会立即调用exec，执行一段新的程序
* vfork与fork一样都创建一个子进程，但vfork并不将父进程的地址空间完全复制到子进程中
* **vfork保证子进程先运行，父进程会出现短暂的终止，子进程会借用父进程的地址空间，之后子进程调用exec或者exit，父进程才继续运行**；
* vfork 中，子进程修改数据会切实影响到父进程；
* fork后父子进程的运行先后与OS的调度有关

### exec

* 当进程调用exec时，该进程执行的程序完全替换为新的程序，而新程序则从其main函数开始执行。
* 注意：exec并没有创建一个新的进程。只是用一个全新的程序替换当前进程的正文，数据，堆和栈段
* exec 会从原进程继承一些属性：ID、用户、工作路径、锁、信号屏蔽等，打开的文件描述符是否继承和 fcntl设置有关。

### clone

clone 可以让你**有选择性的继承父进程的资源**，你可以选择想vfork一样和父进程共享一个虚存空间，从而使创造的是线程，你也可以不和父进程共享，你甚至可以选择创造出来的进程和父进程不再是父子关系，而是兄弟关系

## Reference

1. [APUE](https://item.jd.com/12720738.html)
