# mysql 事务原理

## Redo Log

redo log叫做重做日志，是用来实现事务的持久性。该日志文件由两部分组成：重做日志缓冲（redo log buffer）以及重做日志文件（redo log）,前者是在内存中，后者在磁盘中。

### Redo Log 用于恢复数据保障

mysql 为了提升性能不会把每次的修改都实时同步到磁盘，而是会先存到Boffer Pool(缓冲池)里头，把这个当作缓存来用。然后使用后台线程去做缓冲池和磁盘之间的同步。

那么问题来了，如果还没来的同步的时候宕机或断电了怎么办？还没来得及执行上面图中红色的操作。这样会导致丢部分已提交事务的修改信息！

所以引入了redo log来记录已成功提交事务的修改信息，并且会把redo log持久化到磁盘，系统重启之后在读取redo log恢复最新数据。

## Undo Log

undo log 叫做回滚日志，用于记录数据被修改前的信息。他正好跟前面所说的重做日志所记录的相反，重做日志记录数据被修改后的信息。undo log主要记录的是数据的逻辑变化，为了在发生错误时回滚之前的操作，**需要将之前的操作都记录下来**，然后在发生错误时才可以回滚。

undo log 记录的是修改之前的数据。假如系统错误或者 Rollback 可以根据 undo log 回滚到修改前的状态。

## 事务的实现

前面讲的重做日志，回滚日志以及锁技术就是实现事务的基础。

* 事务的**原子性是通过 undo log 来实现的**
* 事务的**持久性性是通过 redo log 来实现的**
* 事务的**隔离性是通过 (读写锁+MVCC)来实现的**
* 事务的**一致性是通过原子性，持久性，隔离性来实现的**！！！

## Reference

1. [【133期】面试官：你说熟悉MySQL事务，那来谈谈事务的实现原理吧！](https://zhuanlan.zhihu.com/p/162035351)
