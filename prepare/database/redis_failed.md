# 了解什么是 redis 的雪崩、穿透和击穿？redis 崩溃之后会怎么样？应对措施是什么

## 缓存雪崩

缓存雪崩指的是因为流量过多，redis 挂了，所有的流量都直接进入数据库，导致数据库撑不住高压。

### 缓存雪崩解决方案

1. 事前：redis 高可用，避免雪崩，主从 + 哨兵集群；
2. 事中：配置限流、降级中间件，防止 mysql 因为大流量而崩溃；
3. 事后：redis 持久化，一旦重启，快速恢复数据。

## 缓存穿透

经常收到缓存中不存在的数据，导致需要回数据库中查找，这种恶意穿透会加大数据库的压力。

### 缓存穿透的解决方案

解决方式很简单，每次系统 A 从数据库中只要没查到，就写一个空值到缓存里去，比如 set -999 UNKNOWN。然后设置一个过期时间，这样的话，下次有相同的 key 来访问的时候，在缓存失效之前，都可以直接从缓存中取数据。

## 缓存击穿

缓存击穿，就是说某个 key 非常热点，访问非常频繁，处于集中式高并发访问的情况，当这个 key 在失效的瞬间，大量的请求就击穿了缓存，直接请求数据库，就像是在一道屏障上凿开了一个洞。

### 缓存击穿解决方案

* 若缓存的数据是基本不会发生更新的，则可尝试将该热点数据设置为永不过期。
* 若缓存的数据更新不频繁，且缓存刷新的整个流程耗时较少的情况下，则可以采用基于 redis、zookeeper 等分布式中间件的分布式互斥锁，或者本地互斥锁以保证仅少量的请求能请求数据库并重新构建缓存，其余线程则在锁释放后能访问到新缓存。
* 若缓存的数据更新频繁或者缓存刷新的流程耗时较长的情况下，可以利用定时线程在缓存过期前主动的重新构建缓存或者延后缓存的过期时间，以保证所有的请求能一直访问到对应的缓存。

## Reference

1. [了解什么是 redis 的雪崩、穿透和击穿？redis 崩溃之后会怎么样？应对措施是什么](https://zhuanlan.zhihu.com/p/108179009)
